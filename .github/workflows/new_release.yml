name: New Release
on:
  release:
    types: [published]

permissions:
  contents: read

jobs:
  deploy:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Set up Python
      uses: actions/setup-python@v3
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip

    - name: Get release version
      run: |
        python .github/get_release_version.py > version.txt

    - name: Save version to test.toml
      run: |
        VERSION=$(cat version.txt)
        echo "version = \"$VERSION\"" > test.toml

# on:
#   release:
#     types:
#       - created

# jobs:
#   release:
#     runs-on: ubuntu-latest

#     steps:
#     - name: Checkout code
#       uses: actions/checkout@v2

#     - name: Get release version
#       id: get_version
#       run: |
#         python .github/get_release_version.py
#         echo "::set-output name=version::$(cat .github/release_version.txt)"

#     - name: Update version in pyproject.toml
#       run: |
#         VERSION=${{ steps.get_version.outputs.version }}
#         sed -i "s/^version = .*/version = '$VERSION'/" test.toml